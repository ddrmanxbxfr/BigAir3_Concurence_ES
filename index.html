<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BigR³ | Concurrence recherche</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body>
        <!-- Nav Bar -->
 
  <div class="row">
    <div class="large-12 columns">
      <div class="nav-bar right">
       <ul class="button-group">
         <li><a id="btnStart" href="#" class="button">Démarer les requêtes</a></li>
         <li><a id="btnStop" href="#" class="button">Arrêter</a></li>
	</ul>
      </div>
      <h1>BigR³ : Concurence recherche<br /><small>Des recherches massives avec le big data</small></h1>
      <hr />
    </div>
  </div>
 
  <!-- End Nav -->
 
 
  <!-- Main Page Content and Sidebar -->
 
  <div class="row">
 
    <!-- Main Blog Content -->
    <div class="large-12 columns" role="content">
        <h3><a href="#">Liste des utilisateurs bidon</a></h3> 
      <article id="domUserBidon">	
      </article> 
    </div>
 
    <!-- End Main Content --> 
  <!-- End Main Content and Sidebar -->
 
 
  <!-- Footer -->
 
  <footer class="row">
    <div class="large-12 columns">
      <hr />
      <div class="row">
        <div class="large-6 columns">
          <p>Réalisé par l'équipe BigR³.</p>
        </div>
        <div class="large-6 columns">
        </div>
      </div>
    </div>
  </footer>

    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();

// Exécuter la génération des DOM
                window.onload = function(){
                generateDomClientBidon();
	}

    </script>

<!-- Code du demo !!! -->
	<script>
	var runInterval;
	var nbWorker = 0;
	var nbBonhomme = 9*12;
		<!-- Event de démarage des threads !!! -->
		$( "#btnStart" ).click(function() {
			startEventedWebWorker();
		});

		$("#btnStop").click(function() {
			window.clearInterval(runInterval);
		});

		function generateDomClientBidon() {
		var domUsers = document.getElementById("domUserBidon");
		// Ceci ajoute un row de users
		for (var i = 0; i < 9; i++) {
			var row = document.createElement("div");
		row.className="row";
		for (var j = 0; j < 12; j++) {
			var cls1 = document.createElement("div");
			cls1.className="small-1 columns text-center";
			var img = document.createElement("img");
			img.src="img/user.png";
			var p = document.createElement("p");
			p.id ="worker" + nbWorker;

			cls1.appendChild(img);
			cls1.appendChild(p);
			row.appendChild(cls1);
			nbWorker = nbWorker + 1;

		}
		domUsers.appendChild(row);
			}
				nbWorker = 45; // BYPASS CHROME
		};


		// Array des web workers
		var workers = new Array();

		function startEventedWebWorker(){
		//HTML5 Web Workers
		workers = new Array();
		//dom.workers.maxPerDomain = 100; NOTE FONCTIONNE UNIQUEMENT DANS FIREFOX!!
		for (rCpt = 0; rCpt < nbWorker; rCpt++) {
			var worker = new Worker('worker_event.js');
			worker.addEventListener('message', function(e) {
				var strSplit = e.data.split(",");
				var constW = "worker";
				noWorker = constW.concat(strSplit[0]);
			 	var par = document.getElementById(noWorker);
				par.innerHTML = strSplit[1] + "ms";
			}, false);
			
			workers.push(worker); // Ajoute le worker à l'array.
		}


		//alert('nombre de workers : ' + workers.length);
		runInterval = setInterval(function() {
		var qCpt = 0;
		for (var q= 0; q < nbBonhomme; q++) {
			var item  = workers[qCpt];
			item.postMessage(q + ',http://cirq.codingrhemes.com:9200/_search');
			
			if (qCpt = nbWorker)
				qCpt = 0;
			else
				qCpt = qCpt + 1;
			}
		},1000);


		}
	</script>
  </body>
</html>
